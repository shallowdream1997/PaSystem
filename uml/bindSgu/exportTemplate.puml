@startuml
title 用户下载 前端市场复核 模板流程

start

:用户A进入前端市场复核页面;
:点击【下载模板】;

:调用「下载Excel模板接口」;

:读取清单是否符合变体主题绑定的条件配置;

if (符合校验条件?) then (是)
    if (根据中文分类获取ENPT) then (获取到了)
         if (旧PT获取新PT?) then (查到新PT)
            if (根据PT和开发渠道\n查含变体主题) then (查到了)
            :将查询到的变体主题\n作为下拉选项写入模板;
            else
            :报错，禁止下载模板;
                                 note right
                                 报错文本：获取产品线PT变体主题失败
                                 end note
                                 stop;
            endif;

         else (没有查到)
         :报错，禁止下载模板;
                     note left
                     报错文本：获取产品线PT失败
                     end note
                     stop;

         endif;

    else (没有获取到)
    :报错，禁止下载模板;
                         note left
                         报错文本：获取产品线PT失败
                         end note
                         stop;
    endif;


else (否)
    :直接返回;
    note right
    保持原模板格式，导出为 .xlsx 文件;
    返回文件给用户;
    end note
    stop
endif



:其他字段处理保持不变;

:「按变体主题给到的分组属性进行分组，填充到各个列头」;


note right
  - 是否捆绑SGU: 固定下拉值（是/否）
  - SGU分组: 固定下拉值（sgu_1 ~ sgu_12）
  - SGU捆绑渠道: 固定下拉值（如 amazon_us, aliexpress_uk 等）
  - 分组属性值-技术维度: 用户自定义输入（文本）
  - 分组属性值-size: 用户自定义输入（文本）
  - 分组属性值-车型: 用户自定义输入（文本）
end note

:生成并填充模板结构（含下拉、输入占位）;
:导出为 .xlsx 文件;

:返回文件给用户;

stop
@enduml


if (旧PT获取新PT?) is (查到新PT) then
       if (根据PT和开发渠道\n查含变体主题) then (查到了)
                    :将查询到的变体主题\n作为下拉选项写入模板;
                else (没查到)
                    :报错，禁止下载模版;
                    note right
                        报错文本：产品线对应PT查询
                        不到变体主题
                    end note
                    stop
                endif
            else (无法获取到)
                :报错，禁止下载模版;
                note right
                    报错文本：获取产品线PT失败
                end note
                stop
            endif;
        else (没有获取到)
           :报错，禁止下载模板
            note right
            报错文本：获取产品线PT失败
            end note
        endif
        stop
     endif
     stop